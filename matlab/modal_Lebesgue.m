clear
N = 5; 
[rp sp] = EquiNodes2D(500); [rp sp] = xytors(rp,sp);

[rq sq wq] = Cubature2D(2*N+1);
[r s] = Nodes2D(N); [r s] = xytors(r,s); 
Np = length(r);
[r s] = QNodes2D(N); [r s] = xytors(r,s);

% r = [-0.8968532316898645,0.3982993518653447,0.3978382631466154,-0.4980940100997226,-0.8998412094465894,0.7920309320167708,-0.9001058622488827,-0.05007732972494768,0.02289750084338348,-0.8979020577966027,-0.05161942712715207,-0.4975235348941438,-0.5110877092127721,-0.896172961623547,-0.5119017247820049]';
% s = [-0.0530686701240277,-0.4984580098292808,-0.9003147500848969,0.3982002632311986,-0.4984583976019817,-0.8941299128326118,0.3982009522673672,-0.05306872288989844,-0.5109958715674856,-0.8941298666552433,-0.8967623483705202,-0.9003148085904928,0.02217564219171834,0.7923450404031387,-0.5109965442976414]';
% r = [-0.577481890524152,-0.6979784209072049,-0.9261005378863045,0.1568879701435784,-0.9045760697551653,-0.9027097501052324,0.5920624018508198,-0.5047786755466918,-0.6238190954657445,-0.05811159673672549,0.8360908598546688,-0.2713883345507647,-0.6368305132454305,-0.9230064512583414,0.07720573184150727,0.5467234608560792,-0.2956492619400888,-0.9150781568290514,0.2359040658118374,-0.923864588768103,-0.3098475385273428]';
% s = [0.5004883552652438,-0.8940839938189025,-0.15110519726495,-0.6521092849831685,0.1759645278878392,-0.9333811241802712,-0.8940839939774403,-0.6521092997468331,0.2476381922174764,-0.3050578769882315,-0.9333811176159436,0.1759644108911185,-0.3050578905992031,0.5004883823376606,-0.1511051853246766,-0.6316453075555499,-0.408701458747774,-0.6316453169671435,-0.9260565364813174,0.8477291791681128,-0.9260565325714376]';

V = Vandermonde2D(N,r,s);
Vq = Vandermonde2D(N,rq,sq)/V;

% u = randn(Np,1);
% v = randn(Np,1);
u = exp((r+s));
v = sin(pi*(r+s)/2);
norm((u.*v) - (Vq'*diag(wq)*Vq)\(Vq'*(wq.*((Vq*u).*(Vq*v))))) % projection vs nodal colloc


V2 = Vandermonde2D(N+1,r,s);
Vp = Vandermonde2D(N+1,rp,sp);
sk = 1;
id = [];
for i=0:N+1
  for j=0:N+1 - i
      if (i+j)>N
          id = [id sk];
      end
      sk = sk + 1;
  end
end

L = @(V) (sum(abs(V).^2,2));
% L = @(V) sum(abs(V),2);
vv = L(Vp(:,id));
a = 1.5;
vv(abs(vv)>a) = 0;
color_line3(rp,sp,vv,vv,'.');

vv = L(V2(:,id));
vv(abs(vv)>a) = 0;
hold on;plot3(r,s,.1+vv,'ro','markersize',12,'linewidth',2)