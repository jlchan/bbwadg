function [H,D,tL,tR,x]=HGTpEQ3(N)
%==========================================================================
% Purpose: This function computes the operator for
%          p = 3 for the first derivative with N nodes on
%          the domain [-1,1], HGT nodal distribution
% Inputs:
%          N = number of nodes, the minimum is 10
%	   construction of the operators
%
% Outputs:
%           H = SBP norm
%           D = first derivative operator
%           tL = projection operator for the left boundary
%           tR = projection operator for the right boundary
%           x = nodal distribution for the operator
%
% Author: David C. Del Rey Fernandez January 2016
%
%==========================================================================
x = transpose(linspace(1,N,N));
x(1,1) =  0.121805406725435050217120777057e1;
x(2,1) = 0.200118187303121642581192038330e1;
x(3,1) = 0.299758052641803295846100208276e1;

x(N,1) =  N - 0.218054067254350502171207770573e0;
x(N-1,1) = N - 0.100118187303121642581192038330e1;
x(N-2,1) = N - 0.199758052641803295846100208276e1;

g = (N-1)/2;
theta = 1+g;
x = x/g-theta/g;
dx = 2/(N-1);

%-- construct tL and tR
tL = zeros(N,1);tR = zeros(N,1);
tL(1,1) = 0.171144429203423597392755766621e1;
tL(2,1) = -0.139732974075793865391110623516e1;
tL(3,1) = 0.122578672863772379396817901017e1;
tL(4,1) = -0.782366066853610036327357648807e0;
tL(5,1) = 0.288039614468547786284479714257e0;
tL(6,1) = -0.455748275289588639417525066776e-1;

tR(N,1) = tL(1,1);
tR(N-1,1) = tL(2,1);
tR(N-2,1) = tL(3,1);
tR(N-3,1) = tL(4,1);
tR(N-4,1) = tL(5,1);
tR(N-5,1) = tL(6,1);


%-- the general solution, evaluated to 30 digits of precision, is given below, however, Matlab introduces too
%much rounding error in evaluating the expressions
% instead, Maple has been used to compute the H and D matrices with 30
% digits of precision
h11 = 0.541420144730720019301738366218e0;
h22 = 0.949370096821841473047852491437e0;
h33 = 0.101154020202354041478124038032e1;
h44 = 0.996155660273216346449078681413e0;
h55 = 0.100188713387880284774501361316e1;
h66 = 0.999626762271878898675076467455e0;

q11 = -1.46452078236828359415996544029;
q12 = 2.65707073805652131475213495027;
q13 = -2.10667178962698727697523301754;
q14 = 1.32597099814846362002082451835;
q15 = -.490133168717059391299636812242;
q16 = 0.0782840045073453276618758014567;

q21 = -.265618729146668507257019008155;
q22 = -.976265202203324022492791560230; 
q23 = 2.00785990245900487571263191641;
q24 = -1.10198482259315723967041992399;
q25 = 0.400243265800644598166329518237;
q26 = -0.642344143164997044587309422737e-1;

q31 = 0.00880608964863595143342170506882;
q32 = -.295031650707132589409487943029;
q33 = -0.751276552052186354979346103696e0;
q34 = 0.141641855102007921815478432416e1;
q35 = -0.451062285838182154844200120668e0;
q36 = 0.721458479287859296448281381640e-1;

q41 = 0.0130049412494227405121504043958;
q42 = 0.00876144921879422597097096488651;
q43 = -.457404609334429860311265282633;
q44 = -0.306048331281993704383876938931e0;
q45 = 0.908703807461377880198810138407e0;
q46 = -0.183683923979837948653455952791e0; 
q47 = 0.166666666666666666666666666667e-1;

q51 = -0.283058534487864779722084684622e-2;
q52 = 0.00224305401270787588350319563801;
q53 = 0.0979871491007097892308905722478;
q54 = -.683351387191589962140197819833;
q55 = -0.414834097515948216117045451015e-1;
q56 = 0.760768512507979099768062777228e0;
q57 = -0.150000000000000000000000000000e0;
q58 = 0.166666666666666666666666666667e-1;

q61 = -0.285226072463916658924480381990e-3;
q62 = 0.000551352380371849206776627617297;
q63 = -0.162808291838349666458570949582e-1;
q64 = 0.148027725418474771012910155720;
q65 = -.747641156757067230227411226224;
q66 = -0.103853245214717335416064843992e-2;
q67 = 0.750000000000000000000000000000e0;
q68 = -0.150000000000000000000000000000e0;
q69 = 0.166666666666666666666666666667e-1;

H = eye(N,N);
H(1,1) = h11;H(2,2) = h22;H(3,3) = h33;H(4,4)=h44;H(5,5) = h55;H(6,6) = h66;
H(N,N) = h11;H(N-1,N-1) = h22;H(N-2,N-2) = h33;H(N-3,N-3)=h44;H(N-4,N-4) = h55;H(N-5,N-5) = h66;
H = dx*H;

Q = zeros(N,N);

Q(1,1) = q11;Q(1,2) = q12;Q(1,3) = q13;Q(1,4) = q14;Q(1,5) = q15;Q(1,6) = q16;
Q(2,1) = q21;Q(2,2) = q22;Q(2,3) = q23;Q(2,4) = q24;Q(2,5) = q25;Q(2,6) = q26;
Q(3,1) = q31;Q(3,2) = q32;Q(3,3) = q33;Q(3,4) = q34;Q(3,5) = q35;Q(3,6) = q36;
Q(4,1) = q41;Q(4,2) = q42;Q(4,3) = q43;Q(4,4) = q44;Q(4,5) = q45;Q(4,6) = q46;Q(4,7) = q47;
Q(5,1) = q51;Q(5,2) = q52;Q(5,3) = q53;Q(5,4) = q54;Q(5,5) = q55;Q(5,6) = q56;Q(5,7) = q57;Q(5,8) = q58;
Q(6,1) = q61;Q(6,2) = q62;Q(6,3) = q63;Q(6,4) = q64;Q(6,5) = q65;Q(6,6) = q66;Q(6,7) = q67;Q(6,8) = q68;Q(6,9) = q69;

%-- interior
for i = 7:N-6
    Q(i,i-3:i+3) = [-1/60,3/20,-3/4,0,3/4,-3/20,1/60];
end

%-- lower portion of the operator
for i = 1:6
    for j = 1:9
        Q(N-(i-1),N-(j-1)) = -Q(i,j);
    end
end

D = H\Q;